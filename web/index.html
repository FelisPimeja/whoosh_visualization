<!DOCTYPE html>
<html>
<head>
    <title>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–µ–∑–¥–æ–∫</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            max-width: 300px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .time-slider { width: 100%; margin: 10px 0; }
        select, .layer-selector {
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
            border-radius: 3px;
            border: 1px solid #ddd;
        }
        .legend {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 3px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .legend-color {
            width: 20px;
            height: 10px;
            margin-right: 5px;
            display: inline-block;
        }
        .maplibregl-ctrl-top-left {
            top: 10px;
            left: 10px;
            right: auto;
        }

        .maplibregl-ctrl-bottom-left {
            bottom: 10px;
            left: 10px;
            right: auto;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="map-controls">
        <h3>–ü–æ–µ–∑–¥–∫–∏</h3>
        <select id="layer-selector" class="layer-selector">
            <option value="routes">–ú–∞—Ä—à—Ä—É—Ç—ã –ø–æ–µ–∑–¥–æ–∫</option>
            <option value="usage">–í–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–æ—Ä–æ–≥</option>
            <option value="speed">–°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å</option>
            <option value="clusters">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–µ—Å—Ç–∞</option>
    </select>
        <div id="time-controls">
            <label>–í—Ä–µ–º—è —Å—É—Ç–æ–∫: <span id="time-value">12:00</span></label>
            <input type="range" id="time-filter" class="time-slider" min="0" max="23" value="12">
        </div>
        <select id="city-selector">
            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
        </select>
        <div id="trip-count">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
        <div id="usage-legend" class="legend" style="display: none;">
            <h4>–í–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–æ—Ä–æ–≥ (–ø–æ–µ–∑–¥–æ–∫/–¥–µ–Ω—å)</h4>
            <div class="legend-item"><span class="legend-color" style="background: #ffeb3b;"></span> 10-25</div>
            <div class="legend-item"><span class="legend-color" style="background: #ffc107;"></span> 25-50</div>
            <div class="legend-item"><span class="legend-color" style="background: #ff9800;"></span> 50-200</div>
            <div class="legend-item"><span class="legend-color" style="background: #f44336;"></span> 200+</div>
            <div class="legend-item"><span class="legend-color" style="background: #cccccc;"></span> –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
        </div>
        <div id="speed-legend" class="legend" style="display: none;">
            <h4>–°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–∞ —É—á–∞—Å—Ç–∫–µ(–∫–º/—á)</h4>
            <div class="legend-item"><span class="legend-color" style="background: #4caf50;"></span> 4-6</div>
            <div class="legend-item"><span class="legend-color" style="background: #8bc34a;"></span> 6-8</div>
            <div class="legend-item"><span class="legend-color" style="background: #cddc39;"></span> 8-12</div>
            <div class="legend-item"><span class="legend-color" style="background: #ffc107;"></span> 10-16</div>
            <div class="legend-item"><span class="legend-color" style="background: #f44336;"></span> 16+</div>
            <div class="legend-item"><span class="legend-color" style="background: #cccccc;"></span> –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
        </div>
        <div id="clusters-legend" class="legend" style="display: block;">
            <h4>–¢–∏–ø—ã —Ç–æ—á–µ–∫</h4>
            <div class="legend-item">
                <span class="legend-color" style="background: #4285F4; border-radius: 50%; width: 10px; height: 10px;"></span>
                –¢–æ—á–∫–∏ —Å—Ç–∞—Ä—Ç–∞ –ø–æ–µ–∑–¥–æ–∫
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #EA4335; border-radius: 50%; width: 10px; height: 10px;"></span>
                –¢–æ—á–∫–∏ —Ñ–∏–Ω–∏—à–∞ –ø–æ–µ–∑–¥–æ–∫
            </div>
        </div>
    </div>

    <script type="module">

        function getBrowserLanguage() {
            return navigator.language || navigator.userLanguage || 'en';
        }

        // –ü—Ä–∏–º–µ—Ä: –ø–æ–ª—É—á–∞–µ–º 2-–±—É–∫–≤–µ–Ω–Ω—ã–π –∫–æ–¥ —è–∑—ã–∫–∞ ('ru', 'en' –∏ —Ç.–¥.)
        const userLang = getBrowserLanguage().split('-')[0];

        // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç–∏–ª–∏ –∏–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
        import { 
            routeLayerStyle, 
            roadsUsageStyle, 
            roadsSpeedStyle,
            clustersLayerStyle,
            mapStyle 
        } from './js/map-style.js';

     
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        const key = 'QOROh6TWkzoMUDJzqknO';
        const map = new maplibregl.Map({
            container: 'map',
            style: `${mapStyle}?key=${key}`,
            center: [37.618423, 55.751244],
            zoom: 10
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        map.addControl(new maplibregl.NavigationControl(), 'top-left');
        map.addControl(new maplibregl.ScaleControl());

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let currentHour = 12;
        let currentLayer = 'routes';
        const timeFilter = document.getElementById('time-filter');
        const timeValue = document.getElementById('time-value');
        const tripCount = document.getElementById('trip-count');
        const citySelector = document.getElementById('city-selector');
        const layerSelector = document.getElementById('layer-selector');
        const timeControls = document.getElementById('time-controls');
        const usageLegend = document.getElementById('usage-legend');
        const speedLegend = document.getElementById('speed-legend');
        let citiesData;

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
        async function loadCities() {
            const response = await fetch('./data/cities.json');
            return await response.json();
        }

        // –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞ –ø–æ ID
        function findCityById(cityId) {
            for (const group of citiesData.groups) {
                const city = group.cities.find(c => c.id === cityId);
                if (city) return city;
            }
            return null;
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        function saveMapState() {
            const center = map.getCenter();
            const zoom = map.getZoom();
            localStorage.setItem('mapState', JSON.stringify({
                cityId: citySelector.value,
                layer: layerSelector.value,
                hour: timeFilter.value,
                center: [center.lng, center.lat],
                zoom: zoom
            }));
        }

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        function restoreMapState() {
            const savedState = localStorage.getItem('mapState');
            if (savedState) {
                const { cityId, layer, hour, center, zoom } = JSON.parse(savedState);
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º UI —ç–ª–µ–º–µ–Ω—Ç—ã
                if (cityId) citySelector.value = cityId;
                if (layer) {
                    layerSelector.value = layer;
                    setActiveLayer(layer);
                }
                if (hour) {
                    timeFilter.value = hour;
                    timeValue.textContent = hour.toString().padStart(2, '0') + ':00';
                    currentHour = parseInt(hour);
                }

                // –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã
                map.once('idle', () => {
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∫–∞—Ä—Ç—ã
                    if (center && zoom) {
                        map.jumpTo({
                            center: center,
                            zoom: zoom
                        });
                    }
                    
                    // –ï—Å–ª–∏ –±—ã–ª –≤—ã–±—Ä–∞–Ω –≥–æ—Ä–æ–¥ - –ª–µ—Ç–∏–º –∫ –Ω–µ–º—É
                    if (cityId) {
                        const city = findCityById(cityId);
                        if (city) {
                            setTimeout(() => {
                                map.fitBounds(city.bounds, {
                                    padding: {top: 50, bottom: 50, left: 50, right: 50},
                                    speed: 0
                                });
                            }, 500);
                        }
                    }
                    
                    updateRouteFilter();
                });
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        citySelector.addEventListener('change', function(e) {
            const city = e.target.value;
            if (city) {
                flyToCity(city);
            }
            saveMapState();
        });

        layerSelector.addEventListener('change', function(e) {
            setActiveLayer(e.target.value);
            saveMapState();
        });

        timeFilter.addEventListener('input', function(e) {
            currentHour = parseInt(e.target.value);
            timeValue.textContent = currentHour.toString().padStart(2, '0') + ':00';
            updateRouteFilter();
            saveMapState();
        });

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ –∫–∞—Ä—Ç—ã
        map.on('moveend', saveMapState);
        map.on('zoomend', saveMapState);

        // –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ –≥–æ—Ä–æ–¥—É
        function flyToCity(cityId) {
            const city = findCityById(cityId);
            if (city) {
                map.fitBounds(city.bounds, {
                    padding: {top: 50, bottom: 50, left: 50, right: 50},
                    speed: 0.5,
                    essential: true
                });
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–ª–æ—ë–≤
        function setActiveLayer(layer) {
            currentLayer = layer;
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç—å—é —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            timeControls.style.display = layer === 'routes' ? 'block' : 'none';
            usageLegend.style.display = layer === 'usage' ? 'block' : 'none';
            speedLegend.style.display = layer === 'speed' ? 'block' : 'none';
            document.getElementById('clusters-legend').style.display = layer === 'clusters' ? 'block' : 'none';
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç—å—é —Å–ª–æ—ë–≤
            const layers = {
                'routes': 'routes',
                'usage': 'roads-usage',
                'speed': 'roads-speed',
                'clusters': 'clusters'
            };
            
            // –°–Ω–∞—á–∞–ª–∞ —Å–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–ª–æ–∏
            Object.values(layers).forEach(layerId => {
                if (map.getLayer(layerId)) {
                    map.setLayoutProperty(layerId, 'visibility', 'none');
                }
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–ª–æ–π
            if (layers[layer] && map.getLayer(layers[layer])) {
                map.setLayoutProperty(layers[layer], 'visibility', 'visible');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫ –ø–æ–µ–∑–¥–æ–∫ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
            updateTripCount();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–æ—Ä–æ–¥–æ–≤
        async function initCities() {
            citiesData = await loadCities();
            
            citiesData.groups.forEach(group => {
                const optgroup = document.createElement('optgroup');
                optgroup.label = group.name;
                
                group.cities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city.id;
                    option.textContent = city.name;
                    optgroup.appendChild(option);
                });
                
                citySelector.appendChild(optgroup);
            });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        citySelector.addEventListener('change', function(e) {
            const city = e.target.value;
            if (city) {
                flyToCity(city);
                saveMapState(city);
            }
        });

        timeFilter.addEventListener('input', function(e) {
            currentHour = parseInt(e.target.value);
            timeValue.textContent = currentHour.toString().padStart(2, '0') + ':00';
            updateRouteFilter();
        });

        layerSelector.addEventListener('change', function(e) {
            setActiveLayer(e.target.value);
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤
        function updateRouteFilter() {
            if (map.getLayer('routes')) {
                map.setFilter('routes', [
                    'all',
                    ['>=', ['get', 'hour'], currentHour - 2],
                    ['<=', ['get', 'hour'], currentHour + 2]
                ]);
                updateTripCount();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –ø–æ–µ–∑–¥–æ–∫
        function updateTripCount() {
            if (currentLayer === 'routes' && map.getSource('routes')) {
                const features = map.querySourceFeatures('routes', {
                    sourceLayer: 'routes_clean',
                    filter: map.getFilter('routes')
                });
                tripCount.textContent = `–û—Ç–æ–±—Ä–∞–∂–µ–Ω–æ –ø–æ–µ–∑–¥–æ–∫: ${features.length.toLocaleString()}`;
            } 
            else if (currentLayer === 'clusters' && map.getSource('clusters')) {
                const features = map.querySourceFeatures('clusters', {
                    sourceLayer: 'clusters'
                });
                const totalTrips = features.reduce((sum, feature) => sum + (feature.properties.trip_count || 0), 0);
                tripCount.textContent = `–í—Å–µ–≥–æ –ø–æ–µ–∑–¥–æ–∫ –≤ —Ç–æ—á–∫–∞—Ö: ${totalTrips.toLocaleString()}`;
            }
            else {
                tripCount.textContent = '';
            }
        }

        // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–π —Å –º–∞—Ä—à—Ä—É—Ç–∞–º–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã
        map.on('load', async function() {
            await initCities();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–ª–æ–∏
            map.addSource('routes', {
                type: 'vector',
                url: `http://localhost:3000/routes_simplified`,
                promoteId: 'trip_id'
            });

            map.addSource('roads-stat', {
                type: 'vector',
                url: `http://localhost:3000/roads_stat`,
                promoteId: 'segment_id'
            });

            // map.addSource('trip-stat', {
            //     type: 'vector',
            //     url: `http://localhost:3000/get_trip_stat_by_zoom`,
            //     promoteId: 'cluster_id'
            // });

            map.addSource('clusters', {
                type: 'vector',
                url: 'http://localhost:3000/clusters',
                promoteId: 'cluster_id'
            });

            // –ü–æ–ª—É—á–∞–µ–º ID –≤—Å–µ—Ö —Å–ª–æ—ë–≤ –±–∞–∑–æ–≤–æ–π –∫–∞—Ä—Ç—ã
            const baseMapLayers = map.getStyle().layers;

            // –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä–≤—ã–π —Å–ª–æ–π —Å –Ω–∞–¥–ø–∏—Å—è–º–∏
            let firstLabelLayerId;
            for (const layer of baseMapLayers) {
                if (layer.type === 'symbol' && layer.id.includes('label')) {
                    firstLabelLayerId = layer.id;
                    break;
                }
            }

            map.addLayer(routeLayerStyle, firstLabelLayerId);
            map.addLayer(roadsUsageStyle, firstLabelLayerId);
            map.addLayer(roadsSpeedStyle, firstLabelLayerId);
            map.addLayer(clustersLayerStyle, firstLabelLayerId);
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
            restoreMapState();

            // –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
            map.on('click', 'routes', function(e) {
                if (e.features && e.features.length > 0) {
                    new maplibregl.Popup()
                        .setLngLat(e.lngLat)
                        .setHTML(`
                            <h4>–ü–æ–µ–∑–¥–∫–∞ #${e.features[0].properties.trip_id}</h4>
                            <p>üïí ${new Date(e.features[0].properties.started_at).toLocaleTimeString()} - 
                            ${new Date(e.features[0].properties.finished_at).toLocaleTimeString()}</p>
                        `)
                        .addTo(map);
                }
            });

            // –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –¥–æ—Ä–æ–∂–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            map.on('click', ['roads-usage', 'roads-speed'], function(e) {
                if (e.features && e.features.length > 0) {
                    const props = e.features[0].properties;
                    const content = currentLayer === 'usage' 
                        ? `<h4>${props.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h4>
                           <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–µ–∑–¥–æ–∫: ${props.trip_count || 0}</p>`
                        : `<h4>${props.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h4>
                           <p>–°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–∞ —É—á–∞—Å—Ç–∫–µ: ${props.med_speed ? props.med_speed.toFixed(1) + ' –∫–º/—á' : '–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</p>`;
                    
                    new maplibregl.Popup()
                        .setLngLat(e.lngLat)
                        .setHTML(content)
                        .addTo(map);
                }
            });

            map.on('click', 'clusters', function(e) {
                const props = e.features[0].properties;
                new maplibregl.Popup()
                    .setLngLat(e.lngLat)
                    .setHTML(`
                        <div class="popup-content">
                            <h4>${props.point_type === 'start' ? '–¢–æ—á–∫–∞ –Ω–∞—á–∞–ª–∞' : '–¢–æ—á–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è'}</h4>
                            <div class="popup-row">
                                <span class="popup-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–µ–∑–¥–æ–∫:</span>
                                <span class="popup-value">${props.trip_count}</span>
                            </div>
                            <div class="popup-row">
                                <span class="popup-label">ID –∫–ª–∞—Å—Ç–µ—Ä–∞:</span>
                                <span class="popup-value">${props.cluster_id}</span>
                            </div>
                        </div>
                    `)
                    .addTo(map);
            });


            map.on('idle', function() {
                if (currentLayer === 'clusters') {
                    updateTripCount();
                }
            });


            let hoveredClusterId = null;

            map.on('mousemove', 'clusters', function(e) {
                if (e.features.length > 0) {
                    if (hoveredClusterId !== null) {
                        map.setFeatureState(
                            { source: 'clusters', sourceLayer: 'clusters', id: hoveredClusterId },
                            { hover: false }
                        );
                    }
                    
                    hoveredClusterId = e.features[0].id;
                    map.setFeatureState(
                        { source: 'clusters', sourceLayer: 'clusters', id: hoveredClusterId },
                        { hover: true }
                    );
                }
            });

            map.on('mouseleave', 'clusters', function() {
                if (hoveredClusterId !== null) {
                    map.setFeatureState(
                        { source: 'clusters', sourceLayer: 'clusters', id: hoveredClusterId },
                        { hover: false }
                    );
                }
                hoveredClusterId = null;
            });


            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
            map.on('mouseenter', ['routes', 'roads-usage', 'roads-speed'], () => {
                map.getCanvas().style.cursor = 'pointer';
            });
            
            map.on('mouseleave', ['routes', 'roads-usage', 'roads-speed'], () => {
                map.getCanvas().style.cursor = '';
            });

            updateRouteFilter();

        });

    </script>
</body>
</html>